{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="container mt-4">
    <h2>Tenant Dashboard</h2>
    <p>Welcome, {{ user.username }}!</p>

    <!-- Активные бронирования -->
    <h4>Active Bookings</h4>
    {% if active_bookings %}
        <ul class="list-group mb-4">
            {% for booking in active_bookings %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <strong>{{ booking.listing.title }}</strong><br>
                        {{ booking.start_date }} to {{ booking.end_date }}
                        {% if booking.status == 'confirmed' %}
                            <span class="badge bg-success">Confirmed</span>
                        {% elif booking.status == 'rejected' %}
                            <span class="badge bg-danger">Rejected</span>
                        {% elif booking.status == 'cancelled' %}
                            <span class="badge bg-secondary">Cancelled</span>
                        {% else %}
                            <span class="badge bg-warning text-dark">Pending</span>
                        {% endif %}
                    </div>

                    {% if booking.status != 'cancelled' and booking.status != 'rejected' %}
                        <form method="post" action="{% url 'tenant_dashboard' %}">
                            {% csrf_token %}
                            <input type="hidden" name="booking_id" value="{{ booking.id }}">
                            <button type="submit" class="btn btn-sm btn-danger"
                                    {% if booking.start_date <= today %}
                                        disabled
                                    {% endif %}>
                                Cancel Booking
                            </button>
                        </form>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No active bookings.</p>
    {% endif %}

    <!-- Прошлые бронирования -->
    <h4>Past Bookings</h4>
    {% if past_bookings %}
        <ul class="list-group">
            {% for booking in past_bookings %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <strong>{{ booking.listing.title }}</strong><br>
                        {{ booking.start_date }} to {{ booking.end_date }}
                        {% if booking.status == 'confirmed' %}
                            <span class="badge bg-success">Confirmed</span>
                        {% elif booking.status == 'rejected' %}
                            <span class="badge bg-danger">Rejected</span>
                        {% elif booking.status == 'cancelled' %}
                            <span class="badge bg-secondary">Cancelled</span>
                        {% else %}
                            <span class="badge bg-warning text-dark">Pending</span>
                        {% endif %}
                    </div>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No past bookings.</p>
    {% endif %}
</div>
{% endblock %}
