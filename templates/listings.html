{% extends 'base.html' %}
{% load static %}
{% load widget_tweaks %}
{% block content %}
<div class="container mt-4">

  <!-- Заголовок -->
  <h2 class="mb-4">Browse Listings</h2>

<!-- Форма фильтрации -->
<form method="get" class="bg-light p-4 rounded shadow-sm mb-4">
  <div class="row g-2">
    <div class="col-md-3">
      {{ form.keyword.label_tag }}
      {{ form.keyword|add_class:"form-control"|attr:"placeholder:Search by title or description" }}
    </div>
    <div class="col-md-3">
      {{ form.location.label_tag }}
      {{ form.location|add_class:"form-control"|attr:"placeholder:Location" }}
    </div>
    <div class="col-md-2">
      {{ form.min_price.label_tag }}
      {{ form.min_price|add_class:"form-control"|attr:"placeholder:Min Price" }}
    </div>
    <div class="col-md-2">
      {{ form.max_price.label_tag }}
      {{ form.max_price|add_class:"form-control"|attr:"placeholder:Max Price" }}
    </div>
    <div class="col-md-2">
      {{ form.sort_by.label_tag }}
      {{ form.sort_by|add_class:"form-select" }}
    </div>
  </div>

  <div class="row g-2 mt-2">
    <div class="col-md-2">
      {{ form.min_rooms.label_tag }}
      {{ form.min_rooms|add_class:"form-control"|attr:"placeholder:Min Rooms" }}
    </div>
    <div class="col-md-2">
      {{ form.max_rooms.label_tag }}
      {{ form.max_rooms|add_class:"form-control"|attr:"placeholder:Max Rooms" }}
    </div>
    <div class="col-md-3">
      {{ form.housing_type.label_tag }}
      {{ form.housing_type|add_class:"form-select" }}
    </div>
    <div class="col-md-2">
      <label class="invisible d-block">Search</label>
      <button type="submit" class="btn btn-primary w-100">Search</button>
    </div>
  </div>
</form>


  <!-- Список объявлений -->
  {% if listings %}
    <div class="row">
      {% for listing in listings %}
        <div class="col-md-6 mb-4">
          <div class="card h-100 shadow-sm">
            {% if listing.image %}
              <img src="{{ listing.image.url }}" class="card-img-top" alt="{{ listing.title }}" style="height: 250px; object-fit: cover;">
            {% endif %}
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">{{ listing.title }}</h5>
              <p class="card-text mb-1"><strong>Location:</strong> {{ listing.location }}</p>
              <p class="card-text mb-1"><strong>Price:</strong> €{{ listing.price }}</p>
              <p class="card-text mb-1"><strong>Rooms:</strong> {{ listing.rooms }}</p>
              <p class="card-text mb-2"><strong>Type:</strong> {{ listing.get_housing_type_display }}</p>

              <!-- Рейтинг -->
              <div class="mb-2">
                {% if listing.average_rating %}
                  {% include 'includes/rating_stars.html' with rating=listing.average_rating %}
                  <small class="text-muted">({{ listing.average_rating|floatformat:1 }})</small>
                {% else %}
                  <span class="text-muted">No ratings</span>
                {% endif %}
              </div>

              <a href="{% url 'listing_detail' listing.id %}" class="btn btn-outline-primary mt-auto">View Details</a>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- Пагинация -->
    <nav aria-label="Page navigation">
      <ul class="pagination justify-content-center mt-4">
        {% if listings.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?{% if request.GET %}{{ request.GET.urlencode }}&{% endif %}page={{ listings.previous_page_number }}">Previous</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Previous</span></li>
        {% endif %}

        <li class="page-item disabled">
          <span class="page-link">Page {{ listings.number }} of {{ listings.paginator.num_pages }}</span>
        </li>

        {% if listings.has_next %}
          <li class="page-item">
            <a class="page-link" href="?{% if request.GET %}{{ request.GET.urlencode }}&{% endif %}page={{ listings.next_page_number }}">Next</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Next</span></li>
        {% endif %}
      </ul>
    </nav>

  {% else %}
    <div class="alert alert-warning">No listings found matching your criteria.</div>
  {% endif %}

</div>
{% endblock %}



